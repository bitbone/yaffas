== Installation

Yaffas has to be installed on clean Linux distribution.
At the moment Ubuntu 10.04 and Red Hat 5 are officially supported.
The following steps describe how {product} can be installed.
There are packages available for both 32bits and 64bits architectures.

=== System requirements

  * Ubuntu Server 10.04 or Red Hat Enterprise Linux 5
  * Correctly configured fully qualified hostname
  * Static IP address

Yaffas can be installed on a preconfigured Zarafa system, however beware that your configuration will be overwritten and that you can loose your data.

Please also make sure that your MySQL password has no hash sign (#) since there is a problem with the current configuration management.

=== Procedure

Yaffas can be installed from the repositories described below for the two supported Linux distributions.

==== Installation on existing server

Right now the installation on an existing server is not recommended and not supported.
Before considering to go this way, either wait for one of the next releases or install a on a clean machine and migrate your data to the new system.

If it still your wish to install it on an existing server make sure you have a backup or make a copy of your actual machine.

To install {product} on such system you must not install yaffas-config and yaffas-zarafa, which will overwrite your configuration.
yaffas-config is a meta package which depends on yaffas-ldap, yaffas-postfix, yaffas-samba, yaffas-security.

These will install all needed dependencies like openldap, samba, zarafa, etc.
The sourcecode of the packages can be found on http://www.github.com/bitbone/yaffas/.
There you have in base/conf and zarafa/conf the configuration packages.
The needed steps can be found in debian/postinst for Ubuntu systems and redhat/*.spec for RedHat systems.
You have to make sure that every step that is in these scripts is adapted for your system and then executed.

We invite you to ask for community support for this installation path, which we will monitor closely on the forum and possibly create a standardized procedure from this.

==== Ubuntu Server 10.04.2 LTS

**Adding required repositories**

Add the following repositories in order to install {product} and required dependencies via the standard apt commands.

  echo "deb http://repo.yaffas.org/ubuntu ./" >> /etc/apt/sources.list

**Import package key**

  wget -O - http://repo.yaffas.org/ubuntu/repo.key | apt-key add -

[NOTE]
===========

If you need a proxy to download from internet, just set the "http_proxy" variable

  export http_proxy=http://<user>:<password>@<your-proxy>:<port>

===========

**Install the packages**

  apt-get update
  apt-get install yaffas yaffas-zarafa yaffas-config


This will install {product} base modules and zarafa.

[WARNING]
==============

When installing the **yaffas-config** package and its dependencies, the
following settings and data will be deleted or overwritten:

  * existing LDAP tree
  * slapd configuration
  * Samba configuration
  * smbldap-tools configuration
  * postfix configuration
  * zarafa configuration
  * MySQL configuration (optimizations for Zarafa will be made)

==============

During the installation zarafa, mysql, openldap, postfix and many other dependencies are installed.

The package manager will usually ask questions for some packages.
You can skip all of these by pressing "enter" when the dialog pops up.
The configuration of these will be done by the **yaffas-config** package.

Only if you are asked for a MySQL server root password you should enter a password and note it down as you will be asked for MySQL credentials when first using {product}.

image:media/en/1_mysql_thumb.png[link="media/en/1_mysql.png"]
image:media/en/2_mysql_repeat_thumb.png[link="media/en/2_mysql_repeat.png"]

Leave the LDAP configuration values without changes:

image:media/en/3_ldap_thumb.png[link="media/en/3_ldap.png"]
image:media/en/4_ldap_thumb.png[link="media/en/4_ldap.png"]
image:media/en/5_ldap_thumb.png[link="media/en/5_ldap.png"]
image:media/en/6_ldap_thumb.png[link="media/en/6_ldap.png"]
image:media/en/7_ldap_thumb.png[link="media/en/7_ldap.png"]
image:media/en/8_ldap_thumb.png[link="media/en/8_ldap.png"]
image:media/en/9_ldap_thumb.png[link="media/en/9_ldap.png"]

For postfix configuration select the "local only" type:

image:media/en/10_postfix_thumb.png[link="media/en/10_postfix.png"]
image:media/en/11_postfix_thumb.png[link="media/en/11_postfix.png"]
image:media/en/12_postfix_thumb.png[link="media/en/12_postfix.png"]

Use the default values for kerberos configuration:

image:media/en/13_kerberos_thumb.png[link="media/en/13_kerberos.png"]
image:media/en/14_kerberos_thumb.png[link="media/en/14_kerberos.png"]
image:media/en/15_kerberos_thumb.png[link="media/en/15_kerberos.png"]


==== Red Hat Enterprise Linux

The installation on Red Hat Enterprise Linux is similar.

[WARNING]
==============

When installing the **yaffas-config** package and its dependencies, the
following settings and data will be deleted or overwritten:

  * existing LDAP tree
  * slapd configuration
  * Samba configuration
  * smbldap-tools configuration
  * postfix configuration
  * zarafa configuration
  * MySQL configuration (optimizations for Zarafa will be made)

==============

**Adding the required repositories**

Prior to the installation of {product} Zarafa packages have to be installed.
Otherwise the open source packages included in the EPEL repository will be used.
Packages can be downloaded from http://www.zarafa.com/download-release.

The {product} packages will require some dependencies.
As these dependencies are not part of the standard RHEL repository, the following two repositories have to be added to the installed system.

**Repositories for RHEL 5**

Run the following command to install the EPEL repository:

  rpm -Uvh http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-4.noarch.rpm

and run the following commands to add the RPMforge repository:

  rpm -Uvh http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el5.rf.i386.rpm

or

  rpm -Uvh http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el5.rf.x86_64.rpm

**Repositories for RHEL 6**

Run the following command to install the EPEL repository:

  rpm -Uvh http://download.fedoraproject.org/pub/epel/6/i386/epel-release-6-5.noarch.rpm

and run the following commands to add the RPMforge repository:

  rpm -Uvh http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.i686.rpm

or

  rpm -Uvh http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.i686.rpm

[CAUTION]
==============

Because of an dependency conflict the package perl-XML-SAX-Base has to be excluded from the rpmforge repository.
Add the line

+exclude=perl-XML-SAX-Base+

as the last line of the +[rpmforge]+ block.

==============


**yaffas repository**

After the extra repositories are added, the {product} repository has to added:

Create a file "yaffas.repo" in folder /etc/yum.repos.d with the following contents:
----
[yaffas]
name = Yaffas $releasever
baseurl = http://repo.yaffas.org/releases/latest/rhel/$releasever
enabled = 1
protect = 0
gpgcheck = 0
----

**Import GPG keys**

  rpm --import http://repo.yaffas.org/rhel.key

**Packages installation**

  yum install yaffas yaffas-zarafa yaffas-config


=== First steps

After installation, the {product} web interface is accessible at the following URL: `https://<your-server's-ip>:10000`

The username is "admin" and password is "yaffas".

image:media/en/{theme}/16_login_thumb.png[link="media/en/{theme}/16_login.png"]

On first log in the admin password has to be changed.
If you installed the yaffas-zarafa package you have to specify a MySQL user who has permission to create a database for Zarafa.
The database you add here will be used for zarafa and will be created if it does not exists.

image:media/en/{theme}/17_setup_thumb.png[link="media/en/{theme}/17_setup.png"]

After the first login an authentication server should be selected in Accounts -> Authentication.

Choices are Active Directory, remote LDAP and local authentication.

If you select local authentication you can select if you want to use this as authentication server.
Just click on apply if you don't need that.

image:media/en/{theme}/18_authserver_thumb.png[link="media/en/{theme}/18_authserver.png"]

Please note that currently the configuration files (yaffas-config) have to be installed for this step.

On Red Hat Enterprise Linux you also need to start the required services and configure them for automatic start at boot. This is can be done in "System -> Services".
Since by default an iptables firewall is active in Red Hat Enterprise Linux, the ports for the needed services have to be opened manually.

The next step should be to configure the mail server.
Without a working mail server configuration some parts of the system will not work.
It will also not be possible to create resources for Zarafa when no local domain is set for the mail server.

Now you can go Accounts -> User Management and create some users.

image:media/en/{theme}/19_usercreate_thumb.png[link="media/en/{theme}/19_usercreate.png"]

After this step you should be able to login to webacess if you go to https://<your-server's-ip>/webaccess

[IMPORTANT]
==============

The language in the {product} UI has to be set for the folders in Zarafa to be created in the right language. This should be done prior to the creation of users.

==============

=== Additional Steps

When using the supported zarafa packages there will be two more packages available:

* zarafa-webaccess-muc
* zarafa-backup

These have to be installed manually for the corresponding functionality to be available.


