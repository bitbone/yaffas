== Installation

Yaffas muss auf einem frischen System installiert werden. Momentan wird Ubuntu 10.04 und Red Hat 5 unterstützt.
Die Pakete sind für 32 und 64bit geeignet.

=== Systemvorausetzungen

  * Ubuntu 10.04/12.04, Debian 6 oder Red Hat Enterprise Linux 5/6
  * Korrekt konfigurierter Hostname
  * Statische IP Adresse

Diese Anleitung bezieht sich nur auf neu installiert Systeme. Sollten Sie ein bereits konfiguriertes System haben können sie {product} momentan noch nicht nutzen. Diese Option wird später nachgeliefert.

Da es momentan noch ein Problem mit dem Speichern von Konfiguationsdateien gibt, darf das MySQL kein Hash Zeichen enthalten.

=== Vorgehen

Yaffas kann direkt aus den unten angegebenen Repositories installiert werden.

==== Installation auf bestehenden Systemen

Momentan ist es nicht empfohlen und möglich die Installation auf bestehenenden System durchzuführen.
Bevor Sie diesen Schritt in Betracht ziehen, warten Sie besser auf eines der nächtsten Releases oder installieren Sie auf einer neuen Maschine und migrieren Sie Ihre Daten.

Wenn Sie trotzdem es auf einem bestehenden System installieren möchten, stellen Sie sicher dass eine Sicherung der Daten oder der kompletten Maschine vorhanden ist.

Um das {product} auf solch einem System zu installieren, müssen zunächst
Pakete wie unten beschrieben installiert werden. Der Installations-Wizard
muss aber übersprungen werden (Symlink /opt/yaffas/etc/webmin/webmin.acl
muss angepasst werden, sodass er auf webmin.acl-global, statt -setup
zeigt), da er sonst alle Bestandsdaten löschen würde.

Es müssen mehrere Konfigurationsänderungen auf eigene Faust durchgeführt
werden. Die nötigen Details können den relevanten Ressourcen
entnommen werden (/opt/yaffas/share/yaffas-upgrade/,
/opt/yaffas/share/yaffas-ldap/ und der Quellcode dieser Pakete unter
http://www.github.com/bitbone/yaffas/).

==== Ubuntu Server

**Hinzufügen der benötigten Repositories**

_Ubuntu 10.04 LTS_

  echo "deb http://repo.yaffas.org/lucid ./" >> /etc/apt/sources.list

_Ubuntu 12.04 LTS_

  echo "deb http://repo.yaffas.org/precise ./" >> /etc/apt/sources.list

[NOTE]
===========

Wenn für den Internetzugang ein Proxy benötigt wird, muss die Umgebungs-Variable "http_proxy" gesetzt werden.

  export http_proxy="http://<user>:<password>@<your-proxy>:<port>"
  export HTTP_PROXY="$http_proxy"

Diese Einstellung sollte nach der Installation permanent festgelegt
werden, indem der Proxy in der Benutzeroberfläche (Netzwerk &gt;
Konfiguration &gt; HTTP Proxy) eingetragen wird.
Dies stellt außerdem sicher, dass alle unterstützen Dienste den Proxy
ordnungsgemäß nutzen können (wie z.B. ClamAV's freshclam).

===========

**Importieren des Paketkeys**

  wget -O - http://repo.yaffas.org/repo.deb.key | apt-key add -

**Installation der Pakete**

[subs="attributes"]
  apt-get update
  apt-get install {product}

Dies installiert die {product} Basismodule und Zarafa.

Der Paketmanager wird für einige Pakete Fragen stellen. Sie können diese überspringen, indem sie "Return" drücken, wenn ein Dialog erscheint. Nur wenn sie nach einem MySQL-Server root Passwort gefragt werden, sollten sie eines eingeben und es aufschreiben, da sie nach MySQL Zugangsdaten gefragt werden, wenn sie {product} zum ersten Mal benutzen.

image:images/en/1_mysql_thumb.png[link="images/en/1_mysql.png"]
image:images/en/2_mysql_repeat_thumb.png[link="images/en/2_mysql_repeat.png"]

Verändern Sie nicht die LDAP Konfiguration:

image:images/en/3_ldap_thumb.png[link="images/en/3_ldap.png"]
image:images/en/4_ldap_thumb.png[link="images/en/4_ldap.png"]
image:images/en/5_ldap_thumb.png[link="images/en/5_ldap.png"]
image:images/en/6_ldap_thumb.png[link="images/en/6_ldap.png"]
image:images/en/7_ldap_thumb.png[link="images/en/7_ldap.png"]
image:images/en/8_ldap_thumb.png[link="images/en/8_ldap.png"]
image:images/en/9_ldap_thumb.png[link="images/en/9_ldap.png"]

Wählen Sie bei der Postfix Konfiguration nur die Lokale Zustellung aus:

image:images/en/10_postfix_thumb.png[link="images/en/10_postfix.png"]
image:images/en/11_postfix_thumb.png[link="images/en/11_postfix.png"]
image:images/en/12_postfix_thumb.png[link="images/en/12_postfix.png"]

Verwenden Sie die vorgegebenen Werte für die Kerberos Konfiguration:

image:images/en/13_kerberos_thumb.png[link="images/en/13_kerberos.png"]
image:images/en/14_kerberos_thumb.png[link="images/en/14_kerberos.png"]
image:images/en/15_kerberos_thumb.png[link="images/en/15_kerberos.png"]

==== Debian 6

**Hinzufügen der benötigten Repositories**

  echo "deb http://repo.yaffas.org/squeeze ./" >> /etc/apt/sources.list

[NOTE]
===========

Wenn für den Internetzugang ein Proxy benötigt wird, muss die Umgebungs-Variable "http_proxy" gesetzt werden.

  export http_proxy="http://<user>:<password>@<your-proxy>:<port>"
  export HTTP_PROXY="$http_proxy"

Diese Einstellung sollte nach der Installation permanent festgelegt
werden, indem der Proxy in der Benutzeroberfläche (Netzwerk &gt;
Konfiguration &gt; HTTP Proxy) eingetragen wird.
Dies stellt außerdem sicher, dass alle unterstützen Dienste den Proxy
ordnungsgemäß nutzen können (wie z.B. ClamAV's freshclam).

===========

**Importieren des Paketkeys**

  wget -O - http://repo.yaffas.org/repo.deb.key | apt-key add -

**Installation der Pakete**

[subs="attributes"]
  apt-get update
  apt-get install {product}

Dies installiert die {product} Basismodule und Zarafa.

Der Paketmanager wird für einige Pakete Fragen stellen. Sie können diese überspringen, indem sie "Return" drücken, wenn ein Dialog erscheint. Nur wenn sie nach einem MySQL-Server root Passwort gefragt werden, sollten sie eines eingeben und es aufschreiben, da sie nach MySQL Zugangsdaten gefragt werden, wenn sie {product} zum ersten Mal benutzen.

image:images/en/1_mysql_thumb.png[link="images/en/1_mysql.png"]
image:images/en/2_mysql_repeat_thumb.png[link="images/en/2_mysql_repeat.png"]

Verändern Sie nicht die LDAP Konfiguration:

image:images/en/3_ldap_thumb.png[link="images/en/3_ldap.png"]
image:images/en/4_ldap_thumb.png[link="images/en/4_ldap.png"]
image:images/en/5_ldap_thumb.png[link="images/en/5_ldap.png"]
image:images/en/6_ldap_thumb.png[link="images/en/6_ldap.png"]
image:images/en/7_ldap_thumb.png[link="images/en/7_ldap.png"]
image:images/en/8_ldap_thumb.png[link="images/en/8_ldap.png"]
image:images/en/9_ldap_thumb.png[link="images/en/9_ldap.png"]

Wählen Sie bei der Postfix Konfiguration nur die Lokale Zustellung aus:

image:images/en/10_postfix_thumb.png[link="images/en/10_postfix.png"]
image:images/en/11_postfix_thumb.png[link="images/en/11_postfix.png"]
image:images/en/12_postfix_thumb.png[link="images/en/12_postfix.png"]

Verwenden Sie die vorgegebenen Werte für die Kerberos Konfiguration:

image:images/en/13_kerberos_thumb.png[link="images/en/13_kerberos.png"]
image:images/en/14_kerberos_thumb.png[link="images/en/14_kerberos.png"]
image:images/en/15_kerberos_thumb.png[link="images/en/15_kerberos.png"]


==== Red Hat Enterprise Linux

Die Installation unter Red Hat Enterprise Linux verläuft ähnlich der Installation unter Ubuntu.

[NOTE]
===========

Wenn für den Internetzugang ein Proxy benötigt wird, muss die Umgebungs-Variable "http_proxy" gesetzt werden.

  export http_proxy="http://<user>:<password>@<your-proxy>:<port>"
  export HTTP_PROXY="$http_proxy"

Diese Einstellung sollte nach der Installation permanent festgelegt
werden, indem der Proxy in der Benutzeroberfläche (Netzwerk &gt;
Konfiguration &gt; HTTP Proxy) eingetragen wird.
Dies stellt außerdem sicher, dass alle unterstützen Dienste den Proxy
ordnungsgemäß nutzen können (wie z.B. ClamAV's freshclam).

===========

**Hinzufügen der benötigten Repositories**

Um alle Abhängigkeiten automatisch auflösen zu können, sollten die folgenden beiden Repositories eingebunden werden:

**Repositories für RHEL 5**

Der folgende Befehl installiert das EPEL Repository:

  rpm -Uvh http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-4.noarch.rpm

Sollte obige Adresse nicht mehr aktuell sein, weil inzwischen eine neuere
Version des Pakets vorliegt, so kann die aktuellste RPM-Datei unter
folgender Adresse bezogen werden:  http://download.fedoraproject.org/pub/epel/5/i386/repoview/epel-release.html

Mit diesem Befehl wird das RPMforge Repository für 32-bit Systeme installiert:

  rpm -Uvh http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el5.rf.i386.rpm

Folgender Befehl installiert RPMforge für 64-bit Systeme:

  rpm -Uvh http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el5.rf.x86_64.rpm

**Repositories für RHEL 6**

Der folgende Befehl installiert das EPEL Repository:

  rpm -Uvh http://download.fedoraproject.org/pub/epel/6/i386/epel-release-6-7.noarch.rpm

Sollte obige Adresse nicht mehr aktuell sein, weil inzwischen eine neuere
Version des Pakets vorliegt, so kann die aktuellste RPM-Datei unter
folgender Adresse bezogen werden:  http://download.fedoraproject.org/pub/epel/6/i386/repoview/epel-release.html

Mit diesem Befehl wird das RPMforge Repository für 32-bit Systeme installiert:

  rpm -Uvh http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.i686.rpm

Folgender Befehl installiert RPMforge für 64-bit Systeme:

  rpm -Uvh http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm

[NOTE]
==============

Für Red Hat Enterprise Linux Systeme ist es notwendig den Kanal "RHEL Server Optional" zu
https://access.redhat.com/knowledge/solutions/11312[abonnieren].
Dies geschieht nicht automatisch.

==============

**yaffas Repository**

Im Verzeichnis /etc/yum.repos.d die Datei yaffas.repo mit folgendem Inhalt anlegen:
----
[yaffas]
name = Yaffas $releasever
baseurl = http://repo.yaffas.org/releases/latest/rhel/$releasever
enabled = 1
protect = 0
gpgcheck = 1
priority = 1
----

**Importieren des Paketkeys**

  rpm --import http://repo.yaffas.org/repo.rpm.key

**Installation der Pakete**

[subs="attributes"]
  yum install {product}

[NOTE]
================

Wenn das obige Kommando auf RHEL5 zu einem Konflikt zwischen php-common und
php53-common führt, dann ist das auf einen
http://bugs.centos.org/view.php?id=4852[Packaging-Fehler] zurückzuführen.
Workaround:

  yum remove php53 php53-common
  yum install php php-ldap php-mapi php-pecl-json

Danach sollte die yaffas-Installation ohne Probleme möglich sein:

[subs="attributes"]
  yum install {product}

================

=== Erste Schritte

Nach der Installation ist das {product} Webinterface unter folgender URL zu erreichen: `https://<ip-des-servers>:10000`

Der Benutzername ist "admin" und das Passwort "yaffas".

[WARNING]
==============

Bei Installation werden folgende Einstellungen geändert und **Daten
gelöscht oder überschrieben**:

  * bestehender LDAP-Baum
  * slapd Konfiguration
  * Samba Konfiguration
  * smbldap-tools Konfiguration
  * postfix Konfiguration
  * zarafa Konfiguration (wenn yaffas-zarafa installiert wurde)
  * MySQL Konfiguration (Optimierungen für Zarafa werden eingetragen)

==============

Im folgenden Setup-Dialog muss das Admin-Passwort geändert werden. Außerdem muss der Benutzer einen MySQL Benutzer angeben, der die Berechtigung hat auf einem MySQL-Server eine Datenbank für Zarafa anzulegen.

Nach dem ersten Login sollte zunächst der Authentifizerungsserver ausgewählt werden. Zur Auswahl stehen hier Active Directory, lokale Authentifizerung am lokalen LDAP und die Anbindung an einen externen LDAP.

Unter Red Hat Enterprise Linux müssen zudem die benötigten Dienste gestartet und zum automatischen Start beim Booten eingestellt werden. Dies ist unter dem Menüpunkt "System->Dienste" möglich. Da unter RHEL standardmäßig eine iptables-Firewall aktiv ist, müssen die Ports für die benötigten Dienste nachträglich manuell geöffnet werden.

Der nächste Schritt sollte das Konfigurieren des Mailservers sein. Ohne eine funktionierende Mailserverkonfiguration werden einige Teile des Systems nicht funktionieren. Es wird auch nicht möglich sein Ressourcen für Zarafa anzulegen, ohne das eine lokale Domäne für den Mailserver eingerichtet ist.

[IMPORTANT]
==============

Damit die Namen der Ordner in Zarafa in der richtigen Sprache angelegt werden, muss die gewünschte Sprache in der {product} UI eingestellt sein. Dies sollte vor dem Anlegen von Benutzern durchgeführt werden.

==============

=== Zusätzliche Schritte

Wenn die supporteten Zarafa Pakete verwendet werden gibt es zwei zusätzliche Pakete:

* zarafa-webaccess-muc
* zarafa-backup

Diese müssen manuell installiert werden, damit die entsprechenden Funktionen zur Verfügung stehen.

